好的，没问题。这是一份详细的 `opencode` 教程文档，从零开始，涵盖了安装、配置、基本使用、核心命令详解以及一些最佳实践。

---

## opencode 命令行工具入门指南

### 目录
1.  **简介：什么是 opencode？**
2.  **第一部分：安装与配置**
    *   在 Windows 上安装
    *   配置 API 密钥
3.  **第二部分：快速上手**
    *   启动会话
    *   初始化项目 (`/init`)
    *   你的第一个请求
4.  **第三部分：核心 `/` 命令详解**
    *   核心操作命令
    *   模型与配置命令
    *   上下文管理命令
    *   其他实用命令
5.  **第四部分：进阶技巧与最佳实践**
6.  **第五部分：VS Code 集成**

---

### 1. 简介：什么是 opencode？

`opencode` 是一个开源的 AI 编程代理，它直接在你的终端里运行。你可以通过自然语言对话的方式，让它帮你完成编码任务，例如：
*   添加新功能
*   修复 Bug
*   编写测试
*   重构代码
*   解释代码片段

它会读取你的项目文件，理解上下文，然后提出代码修改方案，并在你同意后直接应用到文件里。

### 2. 第一部分：安装与配置

#### 在 Windows 上安装

在 Windows 上，最推荐的方式是手动下载官方编译好的可执行文件。

1.  **下载**：前往 [opencode GitHub Releases 页面](https://github.com/sst/opencode/releases)。找到最新的版本，下载名为 `opencode-windows-x64.zip` 的文件。

2.  **解压**：将下载的压缩包解压，你会得到一个 `opencode.exe` 文件。

3.  **配置环境变量 (关键)**：为了能在任何地方调用 `opencode`，你需要将 `opencode.exe` 所在的**文件夹路径**添加到系统的 `Path` 环境变量中。
    *   搜索并打开“编辑系统环境变量”。
    *   点击“环境变量...”。
    *   在“用户变量”或“系统变量”中找到 `Path`，点击“编辑”。
    *   点击“新建”，将你存放 `opencode.exe` 的文件夹路径（例如 `C:\Tools`）粘贴进去。
    *   一路点击“确定”保存。

4.  **验证**：**重新打开**一个新的终端（CMD 或 PowerShell），输入 `opencode --version`。如果成功显示版本号，说明安装成功。

#### 配置 API 密钥

`opencode` 需要一个大语言模型 (LLM) 的 API 密钥才能工作。

1.  **获取密钥**：从你选择的服务商（如 OpenAI, Anthropic, Google 等）获取 API 密钥。

2.  **设置环境变量**：打开终端，使用 `setx` 命令来设置密钥。**注意：命令执行后需要重启终端才能生效。**

    *   **对于 OpenAI:**
        ```bash
        setx OPENAI_API_KEY "你的sk-开头的密钥"
        ```

    *   **对于 Anthropic (Claude):**
        ```bash
        setx ANTHROPIC_API_KEY "你的密钥"
        ```

3.  **使用内置登录 (推荐)**：你也可以使用内置的授权命令，它会引导你完成配置。
    ```bash
    opencode auth login
    ```

### 3. 第二部分：快速上手

#### 启动会话

进入你的项目根目录，然后运行 `opencode` 命令。

```bash
# 导航到你的项目文件夹
cd D:\my-awesome-project

# 启动 opencode
opencode
```

它会启动一个交互式的全屏会话，接管你的终端。

#### 初始化项目 (`/init`)

第一次在项目中使用时，强烈建议运行 `/init` 命令。

```
/init
```

`opencode` 会扫描你的项目结构和文件，以更好地理解代码的上下文。它还会创建一个 `.opencode/` 文件夹来存放相关信息。

#### 你的第一个请求

初始化后，你就可以直接用自然语言提出你的需求了。

**示例：**
> 给我的 express 应用添加一个 /health 接口，当访问时返回 { status: "ok" }

`opencode` 会分析你的请求，找到相关文件（比如 `server.js` 或 `app.js`），然后提出具体的代码修改方案（会以 diff 的形式展示哪些代码被添加或删除）。

你会在下方看到一个确认提示，输入 `y` 并回车即可应用修改，输入 `n` 则取消。

### 4. 第三部分：核心 `/` 命令详解

在 `opencode` 会话中，以斜杠 `/` 开头的都是内部命令。

#### 核心操作命令

*   `/init`
    **说明**：初始化项目，扫描文件和代码结构。是开始一个新项目的首选命令。

*   `/commit`
    **说明**：将当前 `opencode` 所做的所有未提交的更改生成一个 Git commit。你需要先确保项目是一个 Git 仓库。

*   `/undo`
    **说明**：撤销上一步 `opencode` 应用的代码修改。如果你对结果不满意，这是一个非常有用的命令。

*   `/exit`
    **说明**：退出 `opencode` 会话，返回到你的常规命令行。

#### 模型与配置命令

*   `/models`
    **说明**：列出所有可用的语言模型。你可以看到不同模型的名称（如 `opencode`, `Sonic opencode`, `gpt-4`, `claude-3-opus` 等）。你可以用方向键选择并回车切换模型。

*   `/themes`
    **说明**：列出并切换界面的主题（颜色方案）。

#### 上下文管理命令

这些命令用于精确控制你希望 AI “看到”哪些文件。

*   `/add [文件路径]`
    **说明**：手动将一个或多个文件添加到 AI 的上下文中。当你觉得 AI 忽略了某个关键文件时很有用。
    **示例**：`/add src/utils.js`

*   `/remove [文件路径]` 或 `/rm [文件路径]`
    **说明**：手动从 AI 的上下文中移除一个或多个文件。
    **示例**：`/remove dist/bundle.js`

*   `/files`
    **说明**：显示当前在 AI 上下文中的所有文件列表。

#### 其他实用命令

*   `/help`
    **说明**：显示所有可用的 `/` 命令列表及其简要说明。

*   `/history`
    **说明**：查看你在当前会话中的历史指令。

### 5. 第四部分：进阶技巧与最佳实践

1.  **明确你的意图**：请求越具体，`opencode` 给出的结果越好。
    *   **不好**: "修复我的代码"
    *   **好**: "在 `userController.js` 文件中，当用户未登录时，`/profile` 路由应该重定向到 `/login`，而不是抛出 500 错误。"

2.  **分步解决复杂问题**：不要试图让它一次性构建一个完整的功能。将大任务拆分成小步骤。
    *   第一步：“创建一个 `Button` React 组件，包含 `onClick` 和 `children` props。”
    *   第二步：“现在为这个 `Button` 组件添加一个 `disabled` 状态的样式。”

3.  **结合 Git 使用**：`opencode` 是你的助手，而不是版本控制的替代品。
    *   在运行 `opencode` 前，确保你的工作区是干净的 (`git status`)。
    *   使用 `/commit` 命令或手动 `git commit` 来保存 `opencode` 生成的有效修改。

4.  **善用上下文管理**：对于大型项目，`opencode` 不会读取所有文件。如果它的修改不符合预期，使用 `/files` 检查上下文，并用 `/add` 手动添加相关文件。

### 6. 第五部分：VS Code 集成

为了更流畅的体验，你可以安装官方的 VS Code 扩展。

1.  **安装**：在 VS Code 扩展市场搜索 "opencode" 并安装。
2.  **前提**：你必须已经按照第一部分的方法在系统上装好了 `opencode` 命令行工具。
3.  **使用**：
    *   `Ctrl+Esc`：在一个分屏终端中快速打开或切换到 `opencode`。
    *   `Ctrl+Shift+Esc`：总是启动一个新的 `opencode` 会话。

---

现在你已经掌握了 `opencode` 的核心用法。开始在你的项目里尝试吧，它将成为你强大的编程伙伴！